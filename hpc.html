<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>RML HPC (Big Sky) &mdash; Image Portal Workflows  documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js?v=b3ba4146"></script>
        <script src="_static/doctools.js?v=888ff710"></script>
        <script src="_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="sem_tomo.flow" href="sem_flow.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            Image Portal Workflows
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="development.html">Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="workflows.html">Workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">RML HPC (Big Sky)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#initial-setup">Initial Setup:</a></li>
<li class="toctree-l2"><a class="reference internal" href="#to-update">To update:</a></li>
<li class="toctree-l2"><a class="reference internal" href="#spatialomics-file-layout">Spatialomics file layout.</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Image Portal Workflows</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">RML HPC (Big Sky)</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/hpc.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="rml-hpc-big-sky">
<h1>RML HPC (Big Sky)<a class="headerlink" href="#rml-hpc-big-sky" title="Permalink to this heading"></a></h1>
<section id="initial-setup">
<h2>Initial Setup:<a class="headerlink" href="#initial-setup" title="Permalink to this heading"></a></h2>
<p>To initialise, typically done only at start per env. Use miniconda to set up venv, clone this repo, and pip install to the newly created venv.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># get miniconda dist</span>
<span class="n">wget</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">repo</span><span class="o">.</span><span class="n">anaconda</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">miniconda</span><span class="o">/</span><span class="n">Miniconda3</span><span class="o">-</span><span class="n">py310_23</span><span class="mf">.3.1</span><span class="o">-</span><span class="mi">0</span><span class="o">-</span><span class="n">Linux</span><span class="o">-</span><span class="n">x86_64</span><span class="o">.</span><span class="n">sh</span>
<span class="n">chmod</span> <span class="n">a</span><span class="o">+</span><span class="n">x</span> <span class="n">Miniconda3</span><span class="o">-</span><span class="n">py310_23</span><span class="mf">.3.1</span><span class="o">-</span><span class="mi">0</span><span class="o">-</span><span class="n">Linux</span><span class="o">-</span><span class="n">x86_64</span><span class="o">.</span><span class="n">sh</span>
<span class="o">./</span><span class="n">Miniconda3</span><span class="o">-</span><span class="n">py310_23</span><span class="mf">.3.1</span><span class="o">-</span><span class="mi">0</span><span class="o">-</span><span class="n">Linux</span><span class="o">-</span><span class="n">x86_64</span><span class="o">.</span><span class="n">sh</span>
<span class="c1"># use to create venv, eg prod</span>
<span class="o">/</span><span class="n">gs1</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">hedwig_prod</span><span class="o">/</span><span class="n">miniconda3</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">venv</span> <span class="n">prod</span>
<span class="c1"># get this repo</span>
<span class="n">git</span> <span class="n">clone</span> <span class="n">git</span><span class="nd">@github</span><span class="o">.</span><span class="n">com</span><span class="p">:</span><span class="n">niaid</span><span class="o">/</span><span class="n">image_portal_workflows</span><span class="o">.</span><span class="n">git</span>
<span class="c1"># activate the venv, and install in editable mode (--e)</span>
<span class="n">source</span> <span class="n">prod</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">activate</span>
<span class="n">cd</span> <span class="n">image_portal_workflows</span><span class="o">/</span>
<span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">pip</span> <span class="n">install</span> <span class="o">-</span><span class="n">e</span> <span class="o">.</span>
</pre></div>
</div>
<p>Note <code class="docutils literal notranslate"><span class="pre">ls</span> <span class="pre">~</span></code> should list you <code class="docutils literal notranslate"><span class="pre">image_portal_workflows</span></code></p>
<p>Source being root of HOME is for convenience, and allows each serivce account to look similar.</p>
<p>Set up bashrc to automate venv activation.
Added these lines to <code class="docutils literal notranslate"><span class="pre">.bashrc</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">export</span> <span class="n">HEDWIG_ENV</span><span class="o">=</span><span class="n">prod</span>
<span class="n">source</span> <span class="n">prod</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">activate</span>
</pre></div>
</div>
<p>Set up daemon to use appropriate service file. You will need to email NIAID RML HPC Support to do this.
E.g. for qa <code class="docutils literal notranslate"><span class="pre">helper_scripts/hedwig_listener_qa.service</span></code> would be copied into place.</p>
<p>It’s a good idea to test the <code class="docutils literal notranslate"><span class="pre">ExecStart</span></code> command can be run, eg:</p>
<p><code class="docutils literal notranslate"><span class="pre">image_portal_workflows/helper_scripts/hedwig_reg_listen.sh</span> <span class="pre">listen</span></code></p>
</section>
<section id="to-update">
<h2>To update:<a class="headerlink" href="#to-update" title="Permalink to this heading"></a></h2>
<p>Tag relase, and test in dev etc.
Upon promotion into HPC env do:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">image_portal_workflows</span><span class="o">/</span>
<span class="n">git</span> <span class="n">fetch</span>
<span class="n">git</span> <span class="n">checkout</span> <span class="o">&lt;</span><span class="n">label</span><span class="o">&gt;</span>
<span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">pip</span> <span class="n">install</span> <span class="o">-</span><span class="n">e</span> <span class="o">.</span>
</pre></div>
</div>
<p>Finally register the worlfows with the helper script.</p>
<p><code class="docutils literal notranslate"><span class="pre">./helper_scripts/hedwig_reg_listen.sh</span> <span class="pre">register</span></code></p>
</section>
<section id="spatialomics-file-layout">
<h2>Spatialomics file layout.<a class="headerlink" href="#spatialomics-file-layout" title="Permalink to this heading"></a></h2>
<p>Normally the dir structure is : <code class="docutils literal notranslate"><span class="pre">$lab/$pi/$project/$session/$sample</span></code></p>
<p>For Spatialomics this is not the case, the $sample is not really a sample, it’s grouping of ROIs,
PreROIs, etc from each of the slides.
These grouping directories sit one down from session, in the place a <code class="docutils literal notranslate"><span class="pre">$sample</span></code> normally would be.</p>
<p>For a single unit of work (eg 8 slides) the set up looks like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$lab/$pi/$project/$session/Pre_ROI_Selection
$lab/$pi/$project/$session/Heatmaps
$lab/$pi/$project/$session/HQ_Images
$lab/$pi/$project/$session/ROI_Images
</pre></div>
</div>
<p>and eg:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>ls $lab/$pi/$project/$session/HQ_Images/
slide_1.czi, slide_2.czi, ...
</pre></div>
</div>
<p>and</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>ls $lab/$pi/$project/$session/Pre_ROI_Selection
slide_1_Pre_ROI_a.png, slide_2_Pre_ROI_a.png, ...
</pre></div>
</div>
<p>Note:
Different outputs from different slides are split across different dirs.
The pipeline will not parse out or otherwise link slides together in any way.
Similarly there is no linking from from heatmaps to any specific slide.</p>
<p>Also, other directories can exist in this directory, which will be ignored.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="sem_flow.html" class="btn btn-neutral float-left" title="sem_tomo.flow" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, NIAID.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>