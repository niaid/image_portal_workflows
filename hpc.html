<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>RML HPC (Big Sky) &mdash; Image Portal Workflows  documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="sem_tomo.flow" href="sem_flow.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            Image Portal Workflows
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="development.html">Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="workflows.html">Workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">RML HPC (Big Sky)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#setup">Setup:</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#to-update-source">To update source:</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Image Portal Workflows</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">RML HPC (Big Sky)</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/hpc.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="rml-hpc-big-sky">
<h1>RML HPC (Big Sky)<a class="headerlink" href="#rml-hpc-big-sky" title="Permalink to this heading"></a></h1>
<section id="setup">
<h2>Setup:<a class="headerlink" href="#setup" title="Permalink to this heading"></a></h2>
<p>HPC doesn’t seem to have a current version of Python available. Need to get something set up to init the <code class="docutils literal notranslate"><span class="pre">venvs</span></code>, chose conda.
Install conda as normal (in this case anaconda, should probably use miniconda instead).
Activate once to allow env generation. Don’t allow conda update bashrc, don’t want to run conda upon login.</p>
<p>Load the conda env:</p>
<p><code class="docutils literal notranslate"><span class="pre">eval</span> <span class="pre">&quot;$(/gs1/home/hedwig_dev/anaconda3/bin/conda</span> <span class="pre">shell.bash</span> <span class="pre">hook)&quot;</span></code></p>
<p>Then create the venv, eg <code class="docutils literal notranslate"><span class="pre">dev</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">python3</span> <span class="pre">-m</span> <span class="pre">venv</span> <span class="pre">dev</span></code></p>
<p>Deactivate conda, we shouldn’t need it any more. (This is only needed upon initialization, one time.)</p>
<p><code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">deactivate</span></code></p>
<p>Activate the venv.</p>
<p><code class="docutils literal notranslate"><span class="pre">source</span> <span class="pre">~/dev/bin/activate</span></code></p>
<p>Clone the repo to the root of home.</p>
<p><code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">clone</span> <span class="pre">git&#64;github.com:niaid/image_portal_workflows.git</span></code></p>
<p>Now <code class="docutils literal notranslate"><span class="pre">ls</span> <span class="pre">~</span></code> should list you <code class="docutils literal notranslate"><span class="pre">image_portal_workflows</span></code></p>
<p>Now get dependencies for project:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">image_portal_workflows</span><span class="o">/</span>
<span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">pip</span> <span class="n">install</span> <span class="o">-</span><span class="n">e</span> <span class="o">.</span>
</pre></div>
</div>
<p>Source being root of HOME is for convenience, and allows each serivce account to look similar. We need to install <em>this</em> repo into our venv. To do this tell <code class="docutils literal notranslate"><span class="pre">pip</span></code> the location of <code class="docutils literal notranslate"><span class="pre">setup.py</span></code> within the activated venv, eg:</p>
<p><code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">-m</span> <span class="pre">pip</span> <span class="pre">install</span> <span class="pre">~/image_portal_workflows/</span></code></p>
<p>An alternative setup could be run, similar to pytools, whereby source is retrieved via a git label or branch name via <cite>requirements.txt</cite>. I felt that having a complete git repo available in HOME of each account offered more flexibility.</p>
<p>Set up bashrc to automate venv activation.
Added these lines to <code class="docutils literal notranslate"><span class="pre">.bashrc</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">export</span> <span class="n">HEDWIG_ENV</span><span class="o">=</span><span class="n">qa</span>
<span class="n">source</span> <span class="n">qa</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">activate</span>
</pre></div>
</div>
<p>Set up daemon to use appropriate service file. You will need to email NIAID RML HPC Support to do this.
E.g. for qa <code class="docutils literal notranslate"><span class="pre">helper_scripts/hedwig_listener_qa.service</span></code> would be copied into place.</p>
<p>It’s a good idea to test the <code class="docutils literal notranslate"><span class="pre">ExecStart</span></code> command can be run, eg:</p>
<p><code class="docutils literal notranslate"><span class="pre">image_portal_workflows/helper_scripts/hedwig_reg_listen.sh</span> <span class="pre">listen</span></code></p>
<section id="to-update-source">
<h3>To update source:<a class="headerlink" href="#to-update-source" title="Permalink to this heading"></a></h3>
<p>Tag relase, and test in dev etc.
Upon promotion into HPC env do:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">image_portal_workflows</span><span class="o">/</span>
<span class="n">git</span> <span class="n">fetch</span>
<span class="n">git</span> <span class="n">checkout</span> <span class="o">&lt;</span><span class="n">label</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Once happy this is in order, register the worlfows with the helper script.</p>
<p><code class="docutils literal notranslate"><span class="pre">./helper_scripts/hedwig_reg_listen.sh</span> <span class="pre">register</span></code></p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="sem_flow.html" class="btn btn-neutral float-left" title="sem_tomo.flow" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, NIAID.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>