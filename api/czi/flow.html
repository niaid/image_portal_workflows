<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CZI flow &mdash; Image Portal Workflows  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="CZI constants" href="constants.html" />
    <link rel="prev" title="CZI" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Image Portal Workflows
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../development.html">Project Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../workflows/index.html">Workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usage.html">Submitting Jobs</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">API</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../em_workflows.html">em_workflows</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../config.html">Config module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../file_path.html">File_path module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../utils/index.html">Utils</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dm_conversion/index.html">DM Conversion</a></li>
<li class="toctree-l3"><a class="reference internal" href="../brt/index.html">BRT</a></li>
<li class="toctree-l3"><a class="reference internal" href="../sem_tomo/index.html">SEM Tomo</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="index.html">CZI</a><ul class="current">
<li class="toctree-l4 current"><a class="current reference internal" href="#">CZI flow</a></li>
<li class="toctree-l4"><a class="reference internal" href="constants.html">CZI constants</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../hpc.html">RML HPC (Big Sky)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../prefect.html">Managing Prefect Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../prefect.html#managing-prefect-worker">Managing Prefect Worker</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Image Portal Workflows</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">API</a></li>
          <li class="breadcrumb-item"><a href="../em_workflows.html">em_workflows</a></li>
          <li class="breadcrumb-item"><a href="index.html">CZI</a></li>
      <li class="breadcrumb-item active">CZI flow</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/api/czi/flow.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="module-em_workflows.czi.flow">
<span id="czi-flow"></span><h1>CZI flow<a class="headerlink" href="#module-em_workflows.czi.flow" title="Link to this heading"></a></h1>
<section id="immunofluorescence-if-microscopy-overview">
<h2>Immunofluorescence (IF) microscopy overview:<a class="headerlink" href="#immunofluorescence-if-microscopy-overview" title="Link to this heading"></a></h2>
<blockquote>
<div><ul class="simple">
<li><dl class="simple">
<dt>The CZI file format has been developed by ZEISS to store multidimensional IF images such as:</dt><dd><ul>
<li><p>z-stacks, time lapse, and multiposition experiments.</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>We rely on applications like OME Bio-Formats / OMERO, Fiji, python-bioformats to view and process czi files</p></li>
<li><p>The IF images are visualized with neuroglancer</p></li>
<li><p>The file also consists of metadata along with label and macro (RGB) images</p></li>
</ul>
</div></blockquote>
</section>
<section id="pipeline-overview">
<h2>Pipeline overview:<a class="headerlink" href="#pipeline-overview" title="Link to this heading"></a></h2>
<blockquote>
<div><ul class="simple">
<li><p>Convert czi file to OME-NGFF zarr format with OME XML</p></li>
<li><p>Generate neuroglancer meta-data from zarr sub-image for each IF image</p></li>
<li><p>Create thumbnail image from zarr label sub-image</p></li>
</ul>
</div></blockquote>
</section>
<dl class="py function">
<dt class="sig sig-object py" id="em_workflows.czi.flow.gen_thumb">
<span class="sig-prename descclassname"><span class="pre">em_workflows.czi.flow.</span></span><span class="sig-name descname"><span class="pre">gen_thumb</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">image</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">HedwigZarrImage</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">file_path</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="../file_path.html#file_path.FilePath" title="file_path.FilePath"><span class="pre">FilePath</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">image_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">dict</span></span></span><a class="headerlink" href="#em_workflows.czi.flow.gen_thumb" title="Link to this definition"></a></dt>
<dd><p>Uses SimpleITK to extract and write jpeg thumbnail image for the zarr subimage</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="em_workflows.czi.flow.rechunk_zarr">
<span class="sig-prename descclassname"><span class="pre">em_workflows.czi.flow.</span></span><span class="sig-name descname"><span class="pre">rechunk_zarr</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">file_path</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="../file_path.html#file_path.FilePath" title="file_path.FilePath"><span class="pre">FilePath</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#em_workflows.czi.flow.rechunk_zarr" title="Link to this definition"></a></dt>
<dd><p>Re-chunk the ZARR structure so that multi-channel/RGB channels are not split
between chunks with the zarr_rechunk command provided by tomojs-pytools.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="em_workflows.czi.flow.copy_zarr_to_assets_dir">
<span class="sig-prename descclassname"><span class="pre">em_workflows.czi.flow.</span></span><span class="sig-name descname"><span class="pre">copy_zarr_to_assets_dir</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">file_path</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="../file_path.html#file_path.FilePath" title="file_path.FilePath"><span class="pre">FilePath</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#em_workflows.czi.flow.copy_zarr_to_assets_dir" title="Link to this definition"></a></dt>
<dd><p>Copy the zarr files generated from czi files using bioformats2raw to assets folder</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="em_workflows.czi.flow.generate_imageset">
<span class="sig-prename descclassname"><span class="pre">em_workflows.czi.flow.</span></span><span class="sig-name descname"><span class="pre">generate_imageset</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">file_path</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="../file_path.html#file_path.FilePath" title="file_path.FilePath"><span class="pre">FilePath</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">Dict</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#em_workflows.czi.flow.generate_imageset" title="Link to this definition"></a></dt>
<dd><div class="line-block">
<div class="line">ImageSet consists of all the assets for a particular zarr sub-image and label images</div>
<div class="line">Macro image is ignored</div>
<div class="line">Label image is added as an thumbnail asset</div>
<div class="line">Zarr sub-images are added as neurglancerZarr asset along with their metadata</div>
<div class="line">Metadata includes:
- shader
- dimensions
- shaderParameters</div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="em_workflows.czi.flow.generate_zarr">
<span class="sig-prename descclassname"><span class="pre">em_workflows.czi.flow.</span></span><span class="sig-name descname"><span class="pre">generate_zarr</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">file_path</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="../file_path.html#file_path.FilePath" title="file_path.FilePath"><span class="pre">FilePath</span></a></span></em><span class="sig-paren">)</span><a class="headerlink" href="#em_workflows.czi.flow.generate_zarr" title="Link to this definition"></a></dt>
<dd><p>Uses bioformats2raw command to convert czi file to OME-NGFF zarr file</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="em_workflows.czi.flow.find_thumb_idx">
<span class="sig-prename descclassname"><span class="pre">em_workflows.czi.flow.</span></span><span class="sig-name descname"><span class="pre">find_thumb_idx</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">callback</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">Dict</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">Dict</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#em_workflows.czi.flow.find_thumb_idx" title="Link to this definition"></a></dt>
<dd><p>Locate the index of label image in the image set</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="em_workflows.czi.flow.update_file_metadata">
<span class="sig-prename descclassname"><span class="pre">em_workflows.czi.flow.</span></span><span class="sig-name descname"><span class="pre">update_file_metadata</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">file_path</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="../file_path.html#file_path.FilePath" title="file_path.FilePath"><span class="pre">FilePath</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">callback_with_zarr</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Dict</span></span></span><a class="headerlink" href="#em_workflows.czi.flow.update_file_metadata" title="Link to this definition"></a></dt>
<dd><p>OME-xml metadata can be informative for developers to understand why the
neuroglancer view is not appropriately rendering. This function attaches
xml file location as the file metadata to the zarr group</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="em_workflows.czi.flow.generate_czi_imageset">
<span class="sig-prename descclassname"><span class="pre">em_workflows.czi.flow.</span></span><span class="sig-name descname"><span class="pre">generate_czi_imageset</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">file_path</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="../file_path.html#file_path.FilePath" title="file_path.FilePath"><span class="pre">FilePath</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">Dict</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#em_workflows.czi.flow.generate_czi_imageset" title="Link to this definition"></a></dt>
<dd><p>Subflow for heavy lifting operation</p>
<dl class="simple">
<dt>Overview:</dt><dd><ul class="simple">
<li><p>Generate zarr from czi</p></li>
<li><p>Rechunk zarr files</p></li>
<li><p>Copy zarr files to assets folder</p></li>
<li><p>Generate imageset for the assets</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="id0">
<span class="sig-prename descclassname"><span class="pre">em_workflows.czi.flow.</span></span><span class="sig-name descname"><span class="pre">gen_thumb</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">image</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">HedwigZarrImage</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">file_path</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">FilePath</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">image_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">dict</span></span></span><a class="headerlink" href="#id0" title="Link to this definition"></a></dt>
<dd><p>Uses SimpleITK to extract and write jpeg thumbnail image for the zarr subimage</p>
</dd></dl>

</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="CZI" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="constants.html" class="btn btn-neutral float-right" title="CZI constants" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, NIAID.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>